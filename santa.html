<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÑ Secret Santa Pair Generator</title>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <style>
        :root {
            --primary: #c0392b; /* Christmas Red */
            --secondary: #27ae60; /* Christmas Green */
            --accent: #f1c40f; /* Gold */
            --bg: #ecf0f1;
            --text: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(#dcdcdc 10%, transparent 11%), radial-gradient(#dcdcdc 10%, transparent 11%);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: var(--text);
        }

        .dashboard {
            background: white;
            width: 90%;
            max-width: 700px;
            margin-top: 50px;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 10px solid var(--primary);
            margin-bottom: 50px;
        }

        h1 { color: var(--primary); margin-bottom: 0.5rem; }
        .subtitle { color: #7f8c8d; margin-bottom: 1.5rem; }

        /* --- Input Section --- */
        .controls-area {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #ccc;
        }

        .file-upload-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Custom File Upload Button Styling */
        .custom-file-upload {
            border: 2px dashed var(--secondary);
            display: inline-block;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 8px;
            color: var(--secondary);
            font-weight: bold;
            transition: all 0.2s;
            width: 100%;
        }

        .custom-file-upload:hover {
            background: #e8f6f3;
        }

        input[type="file"] {
            display: none;
        }

        .manual-input-group {
            display: flex;
            gap: 10px;
        }

        input[type="text"] {
            flex-grow: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
        }

        input[type="text"]:focus { border-color: var(--secondary); }

        button {
            cursor: pointer;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            transition: transform 0.1s, opacity 0.2s;
        }

        button:active { transform: scale(0.98); }

        .btn-add {
            background-color: var(--secondary);
            color: white;
            padding: 0 20px;
            font-size: 20px;
        }

        .btn-draw {
            background: linear-gradient(45deg, var(--primary), #e74c3c);
            color: white;
            padding: 15px 30px;
            font-size: 18px;
            width: 100%;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(192, 57, 43, 0.3);
        }

        .btn-draw:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* --- Name List --- */
        .name-pool {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
            min-height: 50px;
        }

        .chip {
            background: #e8f6f3;
            color: var(--secondary);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            border: 1px solid var(--secondary);
            animation: fadeIn 0.3s ease;
        }

        .chip .remove {
            margin-left: 8px;
            cursor: pointer;
            font-weight: bold;
            color: var(--primary);
        }

        /* --- The Modal / Toast Popup --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            position: relative;
            transform: scale(0.7);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid var(--accent);
        }

        .modal-overlay.active { display: flex; }
        .modal-overlay.active .modal-card { transform: scale(1); opacity: 1; }

        .match-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        .vs-badge {
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
        }

        .toast-message {
            background: #fdf2e9;
            border-left: 5px solid var(--accent);
            padding: 15px;
            text-align: left;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .quote-box {
            font-style: italic;
            color: #555;
            margin-top: 20px;
            font-size: 14px;
        }

        .btn-close {
            background: #95a5a6;
            color: white;
            padding: 10px 20px;
            margin-top: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div class="dashboard">
    <h1>üéÖ Secret Santa Pairing</h1>
    <p class="subtitle">Upload names via Excel or add them manually!</p>

    <div class="controls-area">
        <div class="file-upload-wrapper">
            <label for="excelInput" class="custom-file-upload">
                üì• Upload Excel File (.xlsx)
            </label>
            <input type="file" id="excelInput" accept=".xlsx, .xls" onchange="handleFileUpload(event)">
        </div>

        <p style="margin:0; color:#999; font-size:12px;">(Names should be in the first column)</p>

        <div class="manual-input-group">
            <input type="text" id="nameInput" placeholder="Or type a name here..." onkeypress="handleEnter(event)">
            <button class="btn-add" onclick="addName()">+</button>
        </div>
    </div>

    <div id="poolContainer" class="name-pool"></div>

    <button id="drawBtn" class="btn-draw" onclick="drawPair()" disabled>Reveal Next Pair üéÅ</button>
</div>

<div class="modal-overlay" id="resultModal">
    <div class="modal-card">
        <h2>üéâ It's a Match! üéâ</h2>
        
        <div class="match-display">
            <span id="p1Name">Name 1</span>
            <div class="vs-badge">‚ö°</div>
            <span id="p2Name">Name 2</span>
        </div>

        <div class="toast-message">
            <strong>To <span id="t1Name"></span>:</strong><br>
            Give a gift that is <span id="giftTheme1" style="color:var(--primary); font-weight:bold;"></span>.
        </div>

        <div class="toast-message">
            <strong>To <span id="t2Name"></span>:</strong><br>
            Give a gift that is <span id="giftTheme2" style="color:var(--primary); font-weight:bold;"></span>.
        </div>

        <div class="quote-box">"<span id="quoteText"></span>"</div>

        <button class="btn-close" onclick="closeModal()">Close & Continue</button>
    </div>
</div>

<script>
    // --- Data & State ---
    let participants = []; // Empty start
    
    const giftThemes = [
        "Something Red", "Something Sweet", "A DIY Item", 
        "Something Techy", "A Book", "Funny Socks", 
        "Under $10", "Something for the Desk", "A Winter Accessory",
        "A Coffee Mug", "Something Nostalgic", "A Gift Card"
    ];

    const quotes = [
        "It's not how much we give but how much love we put into giving.",
        "Christmas waves a magic wand over this world.",
        "Peace on earth will come to stay, when we live Christmas every day.",
        "The best way to spread Christmas cheer is singing loud for all to hear."
    ];

    // --- DOM Elements ---
    const nameInput = document.getElementById('nameInput');
    const poolContainer = document.getElementById('poolContainer');
    const drawBtn = document.getElementById('drawBtn');
    const resultModal = document.getElementById('resultModal');

    // --- Excel Upload Handler ---
    function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();

        reader.onload = function(e) {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});

            // Get first sheet
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];

            // Convert to array of arrays (treating first row as data, not header)
            // header: 1 means we get an array of arrays like [["Name1"], ["Name2"]]
            const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});

            // Flatten array and filter out empty/non-string values
            const newNames = jsonData.flat().filter(item => typeof item === 'string' && item.trim() !== "");

            // Add to pool
            participants = [...participants, ...newNames];
            
            // Visual Feedback
            renderPool();
            alert(`Loaded ${newNames.length} names from Excel!`);
            
            // Reset input so you can upload same file again if needed
            event.target.value = '';
        };

        reader.readAsArrayBuffer(file);
    }

    // --- Standard Functions ---
    function handleEnter(e) {
        if (e.key === 'Enter') addName();
    }

    function addName() {
        const name = nameInput.value.trim();
        if (!name) return;
        participants.push(name);
        nameInput.value = '';
        renderPool();
    }

    function removeName(index) {
        participants.splice(index, 1);
        renderPool();
    }

    function renderPool() {
        poolContainer.innerHTML = '';
        participants.forEach((name, index) => {
            const chip = document.createElement('div');
            chip.className = 'chip';
            chip.innerHTML = `${name} <span class="remove" onclick="removeName(${index})">&times;</span>`;
            poolContainer.appendChild(chip);
        });

        if (participants.length >= 2) {
            drawBtn.disabled = false;
            drawBtn.innerText = `Reveal Next Pair (${Math.floor(participants.length/2)} pairs left)`;
        } else {
            drawBtn.disabled = true;
            drawBtn.innerText = "Add more names...";
        }
    }

    function drawPair() {
        if (participants.length < 2) return;

        const idx1 = Math.floor(Math.random() * participants.length);
        const person1 = participants[idx1];
        participants.splice(idx1, 1);

        const idx2 = Math.floor(Math.random() * participants.length);
        const person2 = participants[idx2];
        participants.splice(idx2, 1);

        const theme1 = giftThemes[Math.floor(Math.random() * giftThemes.length)];
        const theme2 = giftThemes[Math.floor(Math.random() * giftThemes.length)];
        const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];

        document.getElementById('p1Name').textContent = person1;
        document.getElementById('p2Name').textContent = person2;
        document.getElementById('t1Name').textContent = person1;
        document.getElementById('t2Name').textContent = person2;
        document.getElementById('giftTheme1').textContent = theme1;
        document.getElementById('giftTheme2').textContent = theme2;
        document.getElementById('quoteText').textContent = randomQuote;

        triggerBlast();
        setTimeout(() => { resultModal.classList.add('active'); }, 300);
        renderPool();
    }

    function closeModal() {
        resultModal.classList.remove('active');
    }

    function triggerBlast() {
        const duration = 1500;
        const animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
        const randomInRange = (min, max) => Math.random() * (max - min) + min;

        const interval = setInterval(function() {
            const timeLeft = animationEnd - Date.now();
            if (timeLeft <= 0) return clearInterval(interval);
            const particleCount = 50 * (timeLeft / duration);
            
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
        }, 250);
    }
</script>

</body>
</html>